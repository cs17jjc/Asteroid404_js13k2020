zzfx=((...e)=>zzfxP(zzfxG(...e)));zzfxP=((...e)=>{let t=zzfxX.createBufferSource(),i=zzfxX.createBuffer(e.length,e[0].length,zzfxR);e.map((e,t)=>i.getChannelData(t).set(e)),t.buffer=i,t.connect(zzfxX.destination);return t});zzfxG=((e=1,t=.05,i=220,a=0,n=0,r=.1,l=0,s=1,f=0,u=0,o=0,h=0,c=0,d=0,g=0,y=0,m=0,x=1,p=0,T=zzfxR,b=99+a*T,v=n*T,M=r*T,S=p*T,E=m*T,R=2*Math.PI,O=(e=>0<e?1:-1),w=b+S+v+M+E,P=(f*=500*R/T**2),F=(i*=(1+2*t*Math.random()-t)*R/T),I=O(g)*R/4,N=0,A=0,C=0,k=0,U=0,J=0,D=1,_=[])=>{for(;C<w;_[C++]=J)++U>100*y&&(U=0,J=N*i*Math.sin(A*g*R/T-I),J=O(J=l?1<l?2<l?3<l?Math.sin((J%R)**3):Math.max(Math.min(Math.tan(J),1),-1):1-(2*J/R%2+2)%2:1-4*Math.abs(Math.round(J/R)-J/R):Math.sin(J))*Math.abs(J)**s*e*zzfxV*(C<b?C/b:C<b+S?1-(C-b)/S*(1-x):C<b+S+v?x:C<w-E?(w-C-E)/M*x:0),J=E?J/2+(E>C?0:(C<w-E?1:(C-w)/E)*_[C-E|0]/2):J),N+=1-d+1e9*(Math.sin(C)+1)%2*d,A+=1-d+1e9*(Math.sin(C)**2+1)%2*d,i+=f+=500*u*R/T**3,D&&++D>h*T&&(i+=o*R/T,F+=o*R/T,D=0),c&&++k>c*T&&(i=F,f=P,k=1,D=D||1);return _});zzfxV=.5;zzfxR=44100;zzfxX=new(top.AudioContext||webkitAudioContext);zzfxM=((e,t,i,a=125)=>{let n,r,l,s,f,u,o,h,c,d,g,y,m,x,p,T=0,b=[],v=[],M=[],S=0,E=0,R=1,O={},w=zzfxR/a*60>>2;for(;R;S++)b=[R=h=g=m=0],i.map((a,g)=>{for(o=t[a][S]||[0,0,0],R|=!!t[a][S],p=m+(t[a][0].length-2-!h)*w,x=g==i.length-1,r=2,s=m;r<o.length+x;h=++r){for(f=o[r],c=r==o.length+x-1&&x||d!=(o[0]||0)|f|0,l=0;l<w&&h;l++>w-99&&c?y+=(y<1)/99:0)u=(1-y)*b[T++]/2||0,v[s]=(v[s]||0)-u*E+u,M[s]=(M[s++]||0)+u*E+u;f&&(y=f%1,E=o[1]||0,(f|=0)&&(b=O[[d=o[T=0]||0,f]]=O[[d,f]]||(n=[...e[d]],n[2]*=2**((f-12)/12),f>0?zzfxG(...n):[])))}m=p});return[v,M]});var e=[0,0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];var t=e.slice();t[14]=15;var i=[1,0,0,0,0,0,0,0,0,0,15,0,0,0,0,0,0,0];var a=[2,0,0,0,15,0,0,0,15,0,0,0,0,0,0,0,15,0];var n=[3,-.1,18,0,0,0,18.1,0,0,0,18.5,0,0,0,18.7,0,0,0];var r=[3,-.1,22,0,0,0,22.1,0,0,0,22.5,0,0,0,22.7,0,0,0];var l=[3,-.1,24,0,0,0,24.1,0,0,0,24.5,0,0,0,24.7,0,0,0];var s=[3,-.1,30,0,0,0,30.1,0,0,0,30.5,0,0,0,30.7,0,0,0];var f=[8,9,10,11,8,9,10,11];var u=[[[,0,86,,,,,.7,,,,.5,,6.7,1,.05],[.7,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02],[.4,0,2200,,,.04,3,2,,,800,.02,,4.8,,.01,.1],[,0,130.81,,,1]],[[n],[r],[l],[s],[n,e,i],[r,e,i],[l,e,i],[s,t,i],[n,e,i,a],[r,e,i,a],[l,e,i,a],[s,t,i,a]],[0,1,2,3,0,1,2,3,4,5,6,7,4,5,6,7].concat(f).concat(f).concat(f).concat(f),120,{title:"",author:""}];(function(e){var t=e.noise={};function i(e,t,i){this.x=e;this.y=t;this.z=i}i.prototype.dot2=function(e,t){return this.x*e+this.y*t};i.prototype.dot3=function(e,t,i){return this.x*e+this.y*t+this.z*i};var a=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)];var n=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];var r=new Array(512);var l=new Array(512);t.seed=function(e){if(e>0&&e<1){e*=65536}e=Math.floor(e);if(e<256){e|=e<<8}for(var t=0;t<256;t++){var i;if(t&1){i=n[t]^e&255}else{i=n[t]^e>>8&255}r[t]=r[t+256]=i;l[t]=l[t+256]=a[i%12]}};t.seed(0);function s(e){return e*e*e*(e*(e*6-15)+10)}function f(e,t,i){return(1-i)*e+i*t}t.perlin2=function(e,t){var i=Math.floor(e),a=Math.floor(t);e=e-i;t=t-a;i=i&255;a=a&255;var n=l[i+r[a]].dot2(e,t);var u=l[i+r[a+1]].dot2(e,t-1);var o=l[i+1+r[a]].dot2(e-1,t);var h=l[i+1+r[a+1]].dot2(e-1,t-1);var c=s(e);return f(f(n,o,c),f(u,h,c),s(t))}})(this);class o{constructor(e,t,i){this.x=e;this.y=t;this.biome=i;this.hasPlayer=false;this.resource={type:"NONE"};this.building={type:"NONE"};this.highlighted=false;this.isVisible=false;this.screenPos={x:0,y:0};this.hazard=0}}class h{constructor(e,t,i,a){this.r=e;this.g=t;this.b=i;this.a=a}toHex(){return _(this.r,this.g,this.b,this.a)}darkend(e){return new h(Math.min(255,Math.trunc(this.r*e)),Math.min(255,Math.trunc(this.g*e)),Math.min(255,Math.trunc(this.b*e)),this.a)}}var c=document.getElementById("canv");var d=c.getContext("2d");d.imageSmoothingEnabled=false;var g=[];var y=[];let m=60;let x=.4;let p=[{x:1,y:0},{x:.5,y:.866025},{x:-.5,y:.866025},{x:-1,y:0},{x:-.5,y:-.866025},{x:.5,y:-.866025}];let T=11;let b=5;var v=1;function M(e){var t=e.screenPos;U(t);if(e.isVisible&&e.resource.type!="NONE"){var i=null;switch(e.resource.type){case"IRON":i=new h(165,42,42,255);break;case"COPPER":i=new h(184,115,51,255);break;case"CARBON":i=new h(18,18,18,255);break;case"LITHIUM":i=new h(169,169,169,255);break;case"SILICON":i=new h(0,153,204,255);break;case"ROCK":i=new h(100,100,100,255);break;case"PLUTONIUM":i=new h(0,255,0,255);break}d.lineWidth=3;d.fillStyle=i.toHex();d.strokeStyle=i.darkend(.4).toHex();e.resource.lines.forEach(e=>{d.beginPath();d.moveTo(e[0].x+t.x,e[0].y+t.y);for(var i=1;i<e.length;i++){d.lineTo(e[i].x+t.x,e[i].y+t.y)}d.closePath();d.fill();d.stroke()})}}function S(e,t){var i=g.find(e=>e.hasPlayer);var a=g.filter(e=>Math.abs(e.x-i.x)<=T).sort((e,t)=>e.height-t.height).sort((e,t)=>e.y-t.y).sort((e,t)=>e.isVisible-t.isVisible);a.forEach(t=>{t.screenPos.x=t.x*m*1.5+c.width/2-i.x*m*1.5;t.screenPos.y=t.y*m*2*.8660254037844387*x+e;if(t.x%2!=0){t.screenPos.y+=.8660254037844387*m*x}if(t.isVisible){t.screenPos.y-=t.height;var a=new h(Math.max(0,t.colour.r*(1-t.hazard/10)),Math.min(255,t.colour.g*(1+t.hazard/10)),Math.max(0,t.colour.b*(1-t.hazard/10)),255);d.strokeStyle=t.hazard==0?a.darkend(.2).toHex():a.darkend(1.5).toHex();d.fillStyle=a.toHex();if(Pe.includes(t)){if(Je){d.strokeStyle="#FFFF00"}else if(De){d.strokeStyle="#FF0000"}if(Pe.indexOf(t)==Fe){d.strokeStyle="#00FF00"}}d.lineWidth=3;M(t);switch(t.building.type){case"RADAR":d.drawImage(W,Math.trunc(t.screenPos.x-W.width/2),Math.trunc(t.screenPos.y-W.height*.9));break;case"CONSTRUCTOR":d.drawImage(q,Math.trunc(t.screenPos.x-q.width/2),Math.trunc(t.screenPos.y-q.height*.6));break;case"SOLAR":d.drawImage(Q,Math.trunc(t.screenPos.x-Q.width/2),Math.trunc(t.screenPos.y-Q.height*.5));break;case"MINER":d.drawImage(j,Math.trunc(t.screenPos.x-j.width/2),Math.trunc(t.screenPos.y-j.height*.8));break;case"BATTERY":d.drawImage(Z,Math.trunc(t.screenPos.x-Z.width/2),Math.trunc(t.screenPos.y-Z.height*.6));break;case"RTG":d.drawImage($,Math.trunc(t.screenPos.x-$.width/2),Math.trunc(t.screenPos.y-$.height*.6));break;case"TELEDEPOT":d.drawImage(ee,Math.trunc(t.screenPos.x-ee.width/2),Math.trunc(t.screenPos.y-ee.height*.6));break;case"ROBOSHOP":d.drawImage(te,Math.trunc(t.screenPos.x-te.width/2),Math.trunc(t.screenPos.y-te.height*.6));break;case"GENERATOR":d.drawImage(ie,Math.trunc(t.screenPos.x-ie.width/2),Math.trunc(t.screenPos.y-ie.height*.6));break}}else{d.strokeStyle="#000000";d.fillStyle="#AAAAAA";d.lineWidth=3;M(t);d.fillStyle="#000000";var n=Math.trunc(m*x);d.font=n+"px Arial";d.textAlign="center";d.textBaseline="middle";d.fillText("404",t.screenPos.x,t.screenPos.y)}});var n=a.find(e=>e.hasPlayer);var r=n.screenPos;if(!Te){d.drawImage(K,r.x-Math.trunc(K.width*v/2)+Math.trunc(t.x),Math.trunc(r.y-K.height*v/2-10+Math.sin(180*nt*(Math.PI/180))*4)+Math.trunc(t.y),Math.trunc(K.width*v),Math.trunc(K.height*v))}else{d.drawImage(K,r.x-Math.trunc(K.width*v/2)+Math.trunc(t.x),Math.trunc(r.y-K.height*v/2-10)+Math.trunc(t.y),Math.trunc(K.width*v),Math.trunc(K.height*v))}}function E(){var e=g.filter(e=>e.building.type=="RADAR");g.forEach(t=>{if(e.some(e=>Math.abs(e.x-t.x)<=at)){t.isVisible=true}else{t.isVisible=false}})}function R(e,t,i){var a=-i/2;var n=i/2;var r=-i/2;var l=i/2;d.save();d.translate(e,t);d.strokeStyle="#A2A2A2";d.beginPath();d.moveTo(0,a);d.lineTo(r,n);d.lineTo(l,n);d.closePath();d.stroke();d.fillStyle="#FF0000";d.beginPath();d.arc(0,a,i/4,0,2*Math.PI);d.fill();d.fillStyle="#FFF500";d.beginPath();d.arc(r,n,i/4,0,2*Math.PI);d.fill();d.fillStyle="#0045FF";d.beginPath();d.arc(l,n,i/4,0,2*Math.PI);d.fill();d.restore()}function O(e,t,i,a){var n=i*.25;d.save();d.translate(e,t);d.fillStyle=new h(255-255*a,255*a,0,255).toHex();d.fillRect(0,-i*a,n,i*a);d.strokeStyle="#FFFFFF";d.beginPath();d.moveTo(0,-i);d.lineTo(n,-i);d.lineTo(n,0);d.lineTo(0,0);d.closePath();d.stroke();d.restore()}function w(e,t){ut=0;moving=true;var i=g.find(e=>e.hasPlayer);var a=g.find(a=>a.x==i.x+e&&a.y==i.y+t);if(a!=null){if(a.isVisible){if(Math.abs(a.height-i.height)<=Xe*b){i.hasPlayer=false;a.hasPlayer=true;ye={x:a.x,y:a.y};we={x:i.screenPos.x-a.screenPos.x,y:i.screenPos.y-a.screenPos.y};_t([se,.1,440,,,.07,,,,,50,.07])}else{y.push({text:"Incline too steep",time:0})}}else{y.push({text:"Cannot enter unfound tile",time:0})}}}function P(e,t,i){i=Math.min(1,Math.max(0,i));return e+(t-e)*i}function F(e){if(e.resource.type!="NONE"){var t=e.resource.type;if(e.resource.value==1){e.resource={type:"NONE",value:0}}else{e.resource.value-=1;e.resource.lines=Y(e.resource.value,e.resource.type)}return{type:t,value:1}}else{return e.resource}}function I(e,t){if(e.building.type=="NONE"){e.building.type=t.type;switch(t.type){case"RADAR":E();break;case"CONSTRUCTOR":e.building.energy=0;e.building.maxEnergy=20;e.building.crafting=false;e.building.craftTimer=0;e.building.storedProduct=false;break;case"MINER":e.building.storedResource=0;e.building.storedType=e.resource.type;e.building.maxStored=50;e.building.energy=0;e.building.maxEnergy=10;e.building.mining=false;e.building.mineTimer=0;break;case"BATTERY":e.building.energy=0;e.building.maxEnergy=20;e.building.dischargeTimer=0;e.building.discharging=false;break;case"GENERATOR":e.building.coal=0;e.building.maxCoal=25;e.building.generatingTimer=0;e.building.generating=false;break}t.value-=1;_t([se,,191,,,.07,1,1.09,-5.4,,,,,.4,-.4,.3,,.7])}else{y.push({text:"Cannot place building",time:0})}}function N(e){if(e.building.type!="NONE"){switch(e.building.type){case"RADAR":var t=g.find(e=>e.hasPlayer);var i=g.filter(e=>Math.abs(e.x-t.x)<=at);var a=i.filter(t=>t.building.type=="RADAR"&&t!=e);if(a.length>=1){C(e.building.type,1);e.building={type:"NONE"};E();_t([se,,400,,,.07,1,1.09,-5.4,,,,,.4,-.4,.3,,.7])}else{y.push({text:"No other radar in range",time:0})}break;case"CONSTRUCTOR":if(e.building.storedProduct==true){C(e.building.recipe.product,1)}C(e.building.type,1);e.building={type:"NONE"};_t([se,,400,,,.07,1,1.09,-5.4,,,,,.4,-.4,.3,,.7]);break;case"GENERATOR":A("CARBON",e.building.coal);C(e.building.type,1);e.building={type:"NONE"};_t([se,,400,,,.07,1,1.09,-5.4,,,,,.4,-.4,.3,,.7]);break;default:C(e.building.type,1);e.building={type:"NONE"};_t([se,,400,,,.07,1,1.09,-5.4,,,,,.4,-.4,.3,,.7]);break}}else{y.push({text:"Tile has no building",time:0})}}function A(e,t){var i=Math.min(Ke,t);var a=Ce.find(t=>t.type==e);if(a!=null){if(a.value+i>Ke){i=Ke-a.value}a.value+=i}else{Ce.push({type:e,value:i})}return i}function C(e,t){var i=ke.find(t=>t.type==e);if(i!=null){i.value+=t}else{ke.push({type:e,value:t})}}function k(e,t,i){var a=e.find(e=>e.type==t);if(a!=null){a.value+=i}else{e.push({type:t,value:i})}}function U(e){var t=[];for(var i=0;i<p.length;i++){t.unshift({x:e.x+m*p[i].x,y:e.y+m*p[i].y*x})}d.beginPath();d.moveTo(t[0].x,t[0].y);for(var a=1;a<t.length;a++){d.lineTo(t[a].x,t[a].y)}d.closePath();d.fill();d.stroke()}function J(e,t,i){var a=[];for(var n=0;n<p.length-2;n++){a.unshift({x:e+m*p[n].x,y:t+m*p[n].y*x})}for(var n=p.length-3;n>=0;n--){a.unshift({x:e+m*p[n].x,y:t+i+m*p[n].y*x})}d.beginPath();d.moveTo(a[0].x,a[0].y);for(var r=1;r<a.length;r++){d.lineTo(a[r].x,a[r].y)}d.closePath();d.fill();d.stroke()}function D(e){var t=Math.trunc(e).toString(16);return t.length==1?"0"+t:t}function _(e,t,i,a){return"#"+D(e)+D(t)+D(i)+D(a)}function G(e){var t=.29;var i=.48;var a=[];a.unshift({x:0,y:c.height*t});a.unshift({x:c.width*.09,y:c.height*t});a.unshift({x:c.width*.1,y:c.height*(t-.02)});a.unshift({x:c.width*.1,y:0});a.unshift({x:0,y:0});a.unshift({x:0,y:c.height*i});a.unshift({x:c.width*.09,y:c.height*i});a.unshift({x:c.width*.1,y:c.height*(i-.02)});a.unshift({x:c.width*.1,y:c.height*t});a.unshift({x:0,y:c.height*t});a.unshift({x:0,y:0});var n=.08;a.unshift({x:c.width*(.5-n-.03),y:0});a.unshift({x:c.width*(.5-n),y:c.height*.04});a.unshift({x:c.width*(.5+n),y:c.height*.04});a.unshift({x:c.width*(.5+n+.03),y:0});a.unshift({x:c.width*.83,y:0});a.unshift({x:c.width*.83,y:e-c.height*.02});a.unshift({x:c.width*.85,y:e});a.unshift({x:c.width,y:e});a.unshift({x:c.width,y:0});a.unshift({x:0,y:0});return a}function H(e,t,i){var a=.04;var n=1-i;d.beginPath();d.moveTo(c.width*(i+a),c.height*e);d.lineTo(c.width*(n-a),c.height*e);d.lineTo(c.width*n,c.height*(e+a));d.lineTo(c.width*n,c.height*(e+t-a));d.lineTo(c.width*(n-a),c.height*(e+t));d.lineTo(c.width*(i+a),c.height*(e+t));d.lineTo(c.width*i,c.height*(e+t-a));d.lineTo(c.width*i,c.height*(e+a));d.closePath();d.fill();d.stroke();var r=.02;var l=e+r;var s=t-r*2;d.beginPath();d.moveTo(c.width*(i+r+a),c.height*l);d.lineTo(c.width*(n-r-a),c.height*l);d.lineTo(c.width*(n-r),c.height*(l+a));d.lineTo(c.width*(n-r),c.height*(l+s-a));d.lineTo(c.width*(n-r-a),c.height*(l+s));d.lineTo(c.width*(i+r+a),c.height*(l+s));d.lineTo(c.width*(i+r),c.height*(l+s-a));d.lineTo(c.width*(i+r),c.height*(l+a));d.closePath();d.fill();d.stroke()}function B(e){return g.filter(t=>{var i=t.y-e.y;var a=t.x-e.x;if(Math.abs(i)==1&&a==0){return true}if(i==0&&Math.abs(a)==1){return true}if(e.x%2==0){if(i==-1&&Math.abs(a)==1){return true}}else{if(i==1&&Math.abs(a)==1){return true}}return false})}function Y(e,t){var i=0;switch(t){case"ROCK":i=12;break;case"SILICON":i=5;break;case"LITHIUM":i=9;break;case"CARBON":i=15;break;default:i=7;break}var a=1;var n=e/20;var r=[];for(var l=0;l<a;l++){var s=(Math.random()-.5)*(m*.2)*n;var f=(Math.random()-.5)*(m*.2)*n;r.unshift(L(i,n,f,s))}return r}function L(e,t,i,a){var n=[];var r=[];for(var l=0;l<e;l++){r.unshift(l*(Math.PI*2/e))}r.forEach(e=>{var r=i+(Math.cos(e)*t*m+Math.random()*15*t);var l=a+(Math.sin(e)*t*(m*x)+Math.random()*15*t*x);r=Math.min(m*.6-5,r);r=Math.max(-m*.6+5,r);l=Math.min(m*x-5,l);l=Math.max(-m*x+5,l);n.unshift({x:r,y:l})});return n}function z(e,t,i,a){g=[];for(var n=0;n<5;n++){for(var r=0;r<e;r++){g.push(new o(r,n,t[r]))}}g.forEach(t=>{var n=0;switch(t.biome){case 0:n=Math.abs((noise.perlin2(t.x/10,t.y/10)+1)/2*3);break;case 1:n=Math.abs((noise.perlin2(t.x/10,t.y/10)+1)/2*4);break;case 2:n=Math.abs((noise.perlin2(t.x/10,t.y/10)+1)/2*6);break;case 3:n=Math.abs((noise.perlin2(t.x/10,t.y/10)+1)/2*8);break;case 4:n=Math.abs((noise.perlin2(t.x/10,t.y/10)+1)/2*10);break}n=Math.max(0,Math.trunc(n));t.height=b*n;t.colour=i.find(e=>e.levels.includes(n)).colour;if(Math.abs(a-t.x)>e*.005&&Math.random()*100>85+Math.min(15,Math.abs(a-t.x)/15)){X(t,"IRON",Math.random()*15,10,.6)}else if(Math.abs(a-t.x)>e*.05&&Math.random()*100>90){X(t,"COPPER",Math.random()*15,10,.5)}else if(Math.abs(a-t.x)>e*.08&&Math.random()*100>92){X(t,"CARBON",Math.random()*15,10,.6)}else if(Math.abs(a-t.x)>e*.12&&Math.random()*100>96){X(t,"LITHIUM",Math.random()*15,10,.6)}else if(Math.abs(a-t.x)>e*.14&&Math.random()*100>85){X(t,"SILICON",Math.random()*15,10,.5)}else if(Math.abs(a-t.x)>e*.24&&Math.random()*100>85){var r=Math.random()*15;X(t,"PLUTONIUM",r,10,.7);V(t,4)}else if(Math.random()*100>85+Math.min(15,Math.abs(a-t.x)/10)){X(t,"ROCK",Math.random()*15,10,.9)}if(Math.abs(a-t.x)>e*.16&&Math.random()*100>95){V(t,Math.random()*5)}});g.find(e=>e.x==a).hasPlayer=true;g.filter(e=>e.resource.type!="NONE").forEach(e=>e.resource.lines=Y(e.resource.value,e.resource.type))}function X(e,t,i,a,n){var r=Math.max(a,Math.trunc(i));e.resource={type:t,value:r};B(e).filter(e=>Math.random()>n).forEach(e=>e.resource={type:t,value:Math.max(5,Math.trunc(r*Math.random()))})}function V(e,t){e.hazard=t;B(e).forEach(e=>e.hazard=t*.8)}var K=document.getElementById("rover");var W=document.getElementById("tower");var q=document.getElementById("constructor");var Q=document.getElementById("solar");var j=document.getElementById("miner");var Z=document.getElementById("battery");var $=document.getElementById("rtg");var ee=document.getElementById("teledepot");var te=document.getElementById("shop");var ie=document.getElementById("generator");var ae=["Resume","Main Menu","Save Game","Load Game","Mute Music","Mute Sound FX","Controls"];var ne=0;var re=["New Game","Load Game","Mute Music","Mute Sound FX"];var le=true;var se=0;var fe=()=>zzfx(...[se,.01,593,,.03,0,1,2.04,.1,.1,50,.01,,-.1,,,.06,.96,.08]).start();var ue=()=>zzfx(...[se,0,604,,,.13,4,2.01,-.1,.2,50,,.01,,,.4,.05,.68,.05]).start();var oe=[{product:"EXIT",items:[],energy:0},{product:"RADAR",items:[{type:"IRON",value:18}],energy:8}];var he=[{type:"EXIT",price:0,ammount:0},{type:"ROCK",price:1,ammount:1},{type:"ROCK",price:1,ammount:10},{type:"ROCK",price:1,ammount:50},{type:"IRON",price:5,ammount:1},{type:"IRON",price:5,ammount:10},{type:"IRON",price:5,ammount:50},{type:"COPPER",price:25,ammount:1},{type:"COPPER",price:25,ammount:10},{type:"COPPER",price:25,ammount:50},{type:"CARBON",price:50,ammount:1},{type:"CARBON",price:50,ammount:10},{type:"CARBON",price:50,ammount:50},{type:"LITHIUM",price:75,ammount:1},{type:"LITHIUM",price:75,ammount:10},{type:"LITHIUM",price:75,ammount:50},{type:"SILICON",price:100,ammount:1},{type:"SILICON",price:100,ammount:10},{type:"SILICON",price:100,ammount:50},{type:"PLUTONIUM",price:200,ammount:1},{type:"PLUTONIUM",price:200,ammount:10},{type:"PLUTONIUM",price:200,ammount:50}];var ce=[{type:"EXIT",item:"EXIT",cost:0,costMulti:0,desc:[]},{type:"CRAFT UPGRADES",item:"RESOURCE STORAGE",cost:350,costMulti:2,desc:["Increases JMC™ Craft resource","capacity by 20%"]},{type:"CRAFT UPGRADES",item:"BATTERY EFFICENCY",cost:200,costMulti:1.6,desc:["Increases JMC™ Craft battery capacity","by 25%"]},{type:"CRAFT UPGRADES",item:"CRAFT HEIGHT TOLERANCE",cost:350,costMulti:1.5,desc:["Allows JMC™ Craft to","move between tiles"," with a larger height"," difference."]},{type:"RECIPES",item:"CONSTRUCTOR",cost:500,desc:["Adds JMC™ Constructor to","Constructor Database.","Constructors manufacture other","JMC™ Buildings."]},{type:"RECIPES",item:"MINER",cost:750,desc:["Adds JMC™ Miner to Constructor","Database.","JMC™ Miners use energy to","gather resources 5 times"," more efficent than","the JMC™ Craft"]},{type:"RECIPES",item:"GENERATOR",cost:1025,desc:["Adds JMC™ Generator to Constructor","Database.","JMC™ Generators create energy from","carbon."]},{type:"RECIPES",item:"SOLAR",cost:1250,desc:["Adds JMC™ Solar Panel to ","Constructor Database.","JMC™ Solar Panels generate","fluctuating energy."]},{type:"RECIPES",item:"BATTERY",cost:1650,desc:["Adds JMC™ Battery to ","Constructor Database.","JMC™ Batteries store","energy and release it","periodically."]},{type:"RECIPES",item:"RTG",cost:2500,desc:["Adds JMC™ RTG to ","Constructor Database.","JMC™ RTGs generate","constant energy."]},{type:"BUILDING UPGRADES",item:"RADAR RADIUS",cost:1e3,costMulti:1.5,desc:["Increases JMC™ Radar uncover distance","by 3 tiles."]},{type:"BUILDING UPGRADES",item:"CONSTRUCTOR SPEED",cost:200,costMulti:1.8,desc:["Increases JMC™ Constructor speed","by 30%"]},{type:"BUILDING UPGRADES",item:"CONSTRUCTOR TRANSMITTER",cost:1850,desc:["JMC™ Constructor transmits","finished constructions to","JMC™ Craft."]},{type:"BUILDING UPGRADES",item:"MINER SPEED",cost:750,desc:["Increases JMC™ Miner speed","by 50%"]},{type:"BUILDING UPGRADES",item:"MINER TRANSMITTER",cost:1985,desc:["JMC™ Miner transmits","mined resources to","JMC™ Craft."]},{type:"BUILDING UPGRADES",item:"RTG OUTPUT",cost:250,costMulti:1.8,desc:["Increases JMC™ RTG output","by 1."]},{type:"BUILDING UPGRADES",item:"SOLAR OUTPUT",cost:750,costMulti:1.4,desc:["Increases JMC™ Solar Panel output","by 1."]},{type:"BUILDING UPGRADES",item:"GENERATOR OUTPUT",cost:500,costMulti:2,desc:["Increases JMC™ Generator output","by 1."]}];var de=ce.slice();var ge=oe.slice();var ye={x:0,y:0};var me=1;var xe=50;var pe=50;var Te=false;var be=0;var ve=0;var Me=[800,1500,2500,5e3,1e4,2e4,5e4];var Se=false;var Ee=false;c.width=1280;c.height=720;c.style.width=c.width+"px";c.style.height=c.height+"px";var Re={up:false,down:false,left:false,right:false,inter:false,build:false,remove:false,esc:false,speve:false};var Oe={up:false,down:false,left:false,right:false,inter:false,build:false,remove:false,esc:false,speve:false};var we={x:0,y:0};var g=[];var y=[];var Pe=[];var Fe=0;var Ie=0;var Ne=0;var Ae=0;var Ce=[];var ke=[{type:"RADAR",value:1}];var Ue=0;var Je=false;var De=false;var _e=false;var Ge=false;var He=false;var Be=false;var Ye=false;var Le=50;var ze=1;var Xe=1;var Ve=1;var Ke=50;var We=2;var qe=1;var Qe=5;var je=1;var Ze=false;var $e=false;var et=5;var tt=5;var it=2;var at=6;var nt=0;var rt=0;var lt=0;var st=false;var ft=false;var ut=0;var ot=1;var ht="Nominal";var ct={outline:"#FFFFFF",infill:"#000000AA",text:"#FFFFFF",staticText:"#AAAAAA",dynamicText:"#FFFFFF"};let dt=zzfxM(...u);let gt=zzfxP(...dt);gt.loop=true;gt.start();var yt=Array.from(Array(500).keys()).map(e=>{return{x:Math.random()*2*c.width-c.width,y:Math.random()*2*c.height-c.height,r:Math.random()*3}});noise.seed(Math.random());var mt=500;var xt=[{levels:[0,1,2],colour:new h(62,47,91,255)},{levels:[3,4],colour:new h(190,184,235,255)},{levels:[5,6,7],colour:new h(64,121,140,255)},{levels:[8,9],colour:new h(115,251,211,255)}];var pt=240;var Tt=false;var bt=false;var vt=false;var Mt=0;var St=(new Date).getTime();var Et=0;function Rt(){Et=Ge?0:(new Date).getTime()-St;d.fillStyle="#000000";d.fillRect(0,0,c.clientWidth,c.clientHeight);if(le){wt()}if(bt){Ot()}if(Tt){Ft()}Re=Object.assign({},Oe);St=(new Date).getTime()}function Ot(){d.strokeStyle=ct.outline;d.fillStyle=ct.infill;H(.02,.9,.1);var e=c.width*.13;var t=c.height*.11;d.font="22px Arial";d.fillStyle="#FFFFFF";d.strokeStyle="#000000";d.textAlign="start";d.textBaseline="alphabetic";d.fillText("Welcome, valued Roboemployee, to the JMC™ Autonomous Mining Initative.",e,t);d.fillText("Over the course of the next 7 solar rotations your mining effectiveness will be assesed by",e,50+t);d.fillText("your ability to meet daily monetary quotas.",e,75+t);d.fillText("Quotas can be met by ",e,100+t);var i=d.measureText("Quotas can be met by ").width;d.fillStyle="#00FF00";d.fillText("Mining (E/Space)",e+i,100+t);i=i+d.measureText("Mining (E/Space)").width;d.fillStyle="#FFFFFF";d.fillText(" and selling resources to the TELEDEPOT.",e+i,100+t);d.fillText("Failure to complete these quotas will result in immediate nuclear vapourisation.",e,150+t);d.fillText("JMC™ Operations & Managment regrets to inform you that terrain maps",e,200+t);d.fillText("for JMC™ Planet 404 have been lost, you are required to use your",e,225+t);d.fillText("JMC™ Craft's ",e,250+t);i=d.measureText("JMC™ Craft's ").width;d.fillStyle="#00FF00";d.fillText("Build Mode (B) & Remove Mode (R)",e+i,250+t);i=i+d.measureText("Build Mode (B) & Remove Mode (R)").width;d.fillStyle="#FFFFFF";d.fillText(" to place RADARs and uncover more terrain.",e+i,250+t);d.fillText("The CONSTRUCTOR creates buildings, such as extra RADARs, from resources and energy.",e,300+t);d.fillText("Your JMC™ Craft has a limited battery capacity, failure to charge the battery",e,325+t);d.fillText("will result in loss of resources and buildings in possesion.",e,350+t);d.fillText("An RTG has been made available to provide energy and charge your JMC™ Craft.",e,375+t);d.fillText("A ROBOSHOP has been made available for you to purchase upgrades to aid effectiveness.",e,400+t);d.textAlign="center";d.fillText("WASD to move, left shift to sprint, E/Space to interact.",c.width/2,450+t);d.fillText("Good Luck.",c.width/2,c.height*.82);d.fillText("Press E/Space to start",c.width/2,25+c.height*.85);if(Oe.inter==true&&Re.inter==false){bt=false;Tt=true}}function wt(){d.fillStyle="#FFFFF0";d.save();d.translate(c.width/2,c.height/2);yt.forEach(e=>{d.beginPath();d.arc(e.x,e.y,e.r,0,2*Math.PI);d.fill()});d.restore();d.fillStyle="#FFFFFF";d.textAlign="center";d.textBaseline="middle";d.font="65px Tahoma";d.fillText("Planet 404",c.width/2,c.height*.1);if(Oe.up==true&&Re.up==false){ne=Math.max(0,ne-1);_t([])}if(Oe.down==true&&Re.down==false){ne=Math.min(re.length-1,ne+1);_t([])}if(Oe.inter==true&&Re.inter==false){switch(re[ne]){case"New Game":Pt();se=.5;le=false;ne=0;bt=true;break;case"Load Game":Ct();se=.5;Tt=true;le=false;ne=0;break;case"Mute Music":gt.disconnect();re[ne]="Unmute Music";break;case"Mute Sound FX":se=0;re[ne]="Unmute Sound FX";break;case"Unmute Music":gt.connect(zzfxX.destination);re[ne]="Mute Music";break;case"Unmute Sound FX":se=1;re[ne]="Mute Sound FX";break}fe()}d.font="40px Tahoma";re.forEach(e=>{var t=re.indexOf(e);if(ne==t){var i=d.measureText(e).width;d.drawImage(K,Math.trunc(c.width*.45-i*.5-K.width*.5),Math.trunc(c.height*.3+80*t-K.height*.5));d.drawImage(K,Math.trunc(c.width*.55+i*.5-K.width*.5),Math.trunc(c.height*.3+80*t-K.height*.5));d.fillStyle=ct.dynamicText}else{d.fillStyle=ct.staticText}d.fillText(e,c.width*.5,c.height*.3+80*t)})}function Pt(){var e=Array.from(Array(mt).keys()).map(e=>{var t=Math.abs(pt-e)/(mt*.5);var i=Math.min(4,Math.abs(Math.trunc(5*Math.cos(Math.PI*2*t))));return i});z(mt,e,xt,pt);I(g.find(e=>e.x==pt&&e.y==2),{type:"RADAR",value:1});I(g.find(e=>e.x==pt&&e.y==0),{type:"RTG",value:1});I(g.find(e=>e.x==pt-1&&e.y==0),{type:"CONSTRUCTOR",value:1});I(g.find(e=>e.x==pt+3&&e.y==2),{type:"TELEDEPOT",value:1});I(g.find(e=>e.x==pt-3&&e.y==1),{type:"ROBOSHOP",value:1});w(0,0);ke=[{type:"RADAR",value:1}];Ce=[];be=0;ge=oe.slice();de=ce.slice();Ye=false;Le=50;xe=Le;ze=1;Xe=1;Ve=1;Ke=50;We=1;qe=1;Qe=5;je=3;Ze=false;$e=false;et=1.5;tt=5;at=6;nt=0;rt=0;Se=false;Re={up:false,down:false,left:false,right:false,inter:false,build:false,remove:false,info:false,esc:false,speve:false};Oe={up:false,down:false,left:false,right:false,inter:false,build:false,remove:false,info:false,esc:false,speve:false}}function Ft(){d.fillStyle="#FFFFF0";d.save();d.translate(c.width/2,c.height/2);d.rotate(Math.PI/180*(rt*360+nt));yt.forEach(e=>{d.beginPath();d.arc(e.x,e.y,e.r,0,2*Math.PI);d.fill()});d.restore();S(c.height*.71,we);if(Ge&&!Te&&!Se){d.fillStyle="#FFFFFF";d.textAlign="center";d.textBaseline="middle";d.font="45px Tahoma";d.fillText("Paused",c.width/2,30);d.font="35px Tahoma";ae.forEach(e=>{var t=ae.indexOf(e);if(ne==t){var i=d.measureText(e).width;d.drawImage(K,Math.trunc(c.width*.45-i*.5-K.width*.5),Math.trunc(c.height*.15+50*t-K.height*.5));d.drawImage(K,Math.trunc(c.width*.55+i*.5-K.width*.5),Math.trunc(c.height*.15+50*t-K.height*.5));d.fillStyle=ct.dynamicText}else{d.fillStyle=ct.staticText}d.fillText(e,c.width*.5,c.height*.15+50*t)});Nt()}else if(!Te&&!Se&&!Ee){d.font="15px Arial";d.fillStyle="#FFFFFF";d.strokeStyle="#000000";d.textAlign="start";d.textBaseline="alphabetic";g.filter(e=>e.isVisible&&e.building.type!="NONE").forEach(e=>Jt(e));we.x=P(we.x,0,Et/150*me);we.y=P(we.y,0,Et/150*me);if(Oe.speve==true&&Re.speve==false){me=1.8}else if(Oe.speve==false&&Re.speve==true){me=1}Ce=Ce.filter(e=>e.value>0);Ie=Math.min(he.filter(e=>Ce.some(t=>e.type==t.type&&t.value>=e.ammount)||e.type=="EXIT").length-1,Ie);ke=ke.filter(e=>e.value>0);Ae=Math.min(de.length-1,Ae);if(Je&&(ke.length==0||!Pe.some(e=>e.building.type=="NONE"))){Fe=0;Je=false;Pe=[]}if(De&&!Pe.some(e=>e.building.type!="NONE")){Fe=0;De=false;Pe=[]}if(He&&he.filter(e=>Ce.some(t=>e.type==t.type&&t.value>=e.ammount)).length==0){Ie=0;He=false}var e=g.find(e=>e.hasPlayer);if(pe<xe){st=false;ht="Charging"}else if(He||Be||["SOLAR","RTG","GENERATOR"].some(t=>t==e.building.type)){st=false;ht="Paused"}else{xe-=(ze+e.hazard)*(Et/1e3)}Ut();It()}else if(Te){we.y=P(we.y,10,Et/1500);v=P(v,0,Et/1500);var t=Math.trunc(50-50*v);d.font=t+"px Arial";d.fillStyle="#FFFFFF";d.strokeStyle="#000000";d.textAlign="center";d.textBaseline="middle";d.fillText("You Died",c.width/2,c.height*.2);if(v<.4){(t*.3).toFixed(0)+"px Arial";d.fillText("Press E/Space to respawn",c.width/2,c.height*.3);if(Oe.inter==true&&Re.inter==false){xe=Le;Ce=[];ke=[];g.find(e=>e.hasPlayer).hasPlayer=false;g.find(e=>e.x==pt).hasPlayer=true;w(0,0);Te=false;v=1;we={x:0,y:0}}}}else if(Se){we.y=P(we.y,10,Et/1500);v=P(v,0,Et/1500);var t=Math.trunc(50-50*v);d.font=t+"px Arial";d.fillStyle="#FFFFFF";d.strokeStyle="#000000";d.textAlign="center";d.textBaseline="middle";d.fillText("Quota Failed",c.width/2,c.height*.2);g.forEach(e=>e.hazard+=Et/800);if(v<.4){(t*.3).toFixed(0)+"px Arial";d.fillText("Press E to return to main menu",c.width/2,c.height*.3);if(Oe.inter==true&&Re.inter==false){le=true;Ge=false;Tt=false;Se=false;ne=0;v=1}}if(v>.8){d.fillStyle="#FFFFFF"+D(255-255*((1-v)/.2));d.beginPath();d.arc(c.width/2,c.height/2,c.width*((1-v)/.2),0,2*Math.PI);d.fill()}else{d.fillStyle="#FFFFFF"+D(255*(v/.8));d.fillRect(0,0,c.width,c.height)}}else if(Ee){d.strokeStyle=ct.outline;d.fillStyle=ct.infill;H(.05,.5,.2);var i=c.width/2*.45;d.font="20px Arial";d.fillStyle="#FFFFFF";d.strokeStyle="#000000";d.textAlign="start";d.textBaseline="alphabetic";d.fillText("Congratulations, you have completed all JMC™ Mining Initative quotas.",i,c.height*.2);d.fillText("Due to the costs of JMC™ Craft recovery, you have been offered an",i,25+c.height*.2);d.fillText("involutary position as cheif of planetary excavations and are forbidden",i,50+c.height*.2);d.fillText("from leaving this planet.",i,75+c.height*.2);d.textAlign="center";d.fillText("Thanks for playing!",c.width/2,c.height*.45);if(nt>=1.5){d.fillText("Press E to enter endless mode",c.width/2,25+c.height*.45);if(Oe.inter==true&&Re.inter==false){Ye=true;Ee=false}}}if(xe<=0&&!Te){Te=true;_t([se,,160,.01,.2,.04,2,,-.1,.1,-100,.1])}pe=xe;if(!Te){nt+=Et/800}if(nt>=359){if(be>=Me[rt]&&!(Ee||Ye)){be-=Me[rt];if(rt==Me.length-1){Ee=true;_t([se,0,220,,2,.08,1.5,,,,50,.07,.1,,,,.01])}else{_t([se,0,160,,1,.04,2,,,,25,.07,.03,,,,.01])}}else if(!(Ee||Ye||Se)){Se=true;_t([,,299,.01,.03,1.95,3,.1,.9,.6,,,,.5,.9,.6,,.52,.06]);_t([,0,160,,1.25,.04,2,,,,-25,.25,.01,,,,.01])}rt+=1}nt=nt>=359?0:nt}function It(){if(Oe.up==true&&Re.up==false&&!Je&&!De&&!_e&&!Ge&&!He&&!Be&&Math.abs(we.y)<10){w(0,-1)}if(Oe.down==true&&Re.down==false&&!Je&&!De&&!_e&&!Ge&&!He&&!Be&&Math.abs(we.y)<10){w(0,1)}if(Oe.up==true&&Re.up==true&&!Je&&!De&&!_e&&!Ge&&!He&&!Be&&Math.abs(we.y)<10){w(0,-1)}if(Oe.down==true&&Re.down==true&&!Je&&!De&&!_e&&!Ge&&!He&&!Be&&Math.abs(we.y)<10){w(0,1)}if(Oe.up==true&&Re.up==false&&Je){Ue=Math.max(0,Ue-1);_t([])}if(Oe.down==true&&Re.down==false&&Je){Ue=Math.max(0,Math.min(ke.length-1,Ue+1));_t([])}if(Oe.up==true&&Re.up==false&&_e){Ue=Math.max(0,Ue-1);_t([])}if(Oe.down==true&&Re.down==false&&_e){Ue=Math.max(0,Math.min(ge.length-1,Ue+1));_t([])}if(Oe.up==true&&Re.up==false&&He){ut=0;Ie=Math.max(0,Ie-1);_t([])}if(Oe.down==true&&Re.down==false&&He){ut=0;Ie=Math.min(he.filter(e=>Ce.some(t=>e.type==t.type&&t.value>=e.ammount)||e.type=="EXIT").length-1,Ie+1);_t([])}if(Oe.up==true&&Re.up==false&&Be){ut=0;Ae=Math.max(0,Ae-1);_t([])}if(Oe.down==true&&Re.down==false&&Be){ut=0;Ae=Math.min(de.length-1,Ae+1);_t([])}if(Oe.up==true&&Re.up==true&&He){if(ut>=1){Ie=Math.max(0,Ie-1);ut=0;_t([])}else{ut+=Et/100}}if(Oe.down==true&&Re.down==true&&He){if(ut>=1){Ie=Math.min(he.filter(e=>Ce.some(t=>e.type==t.type&&t.value>=e.ammount)||e.type=="EXIT").length-1,Ie+1);ut=0;_t([])}else{ut+=Et/100}}if(Oe.up==true&&Re.up==true&&Be){if(ut>=1){Ae=Math.max(0,Ae-1);ut=0;_t([])}else{ut+=Et/100}}if(Oe.down==true&&Re.down==true&&Be){if(ut>=1){Ae=Math.min(de.length-1,Ae+1);ut=0;_t([])}else{ut+=Et/100}}
if(Oe.right==true&&Re.right==false&&!Je&&!De&&!Ge&&!He&&!Be&&Math.abs(we.x)<10){w(1,0)}if(Oe.left==true&&Re.left==false&&!Je&&!De&&!Ge&&!He&&!Be&&Math.abs(we.x)<10){w(-1,0)}if(Oe.right==true&&Re.right==true&&!Je&&!De&&!Ge&&!He&&!Be&&Math.abs(we.x)<10){w(1,0)}if(Oe.left==true&&Re.left==true&&!Je&&!De&&!Ge&&!He&&!Be&&Math.abs(we.x)<10){w(-1,0)}if(Oe.right==true&&Re.right==false&&(Je||De)){if(Fe==Pe.length-1){Fe=0}else{Fe+=1}}if(Oe.left==true&&Re.left==false&&(Je||De)){if(Fe==0){Fe=Pe.length-1}else{Fe-=1}}if(Oe.inter==true&&Re.inter==false&&!Je&&!De&&!Ge){ot=1;ut=0;var e=g.find(e=>e.hasPlayer);if(e.building.type!="NONE"){kt(e)}else{if(e.resource.type!="NONE"){var t=Math.round(Ve);if(A(e.resource.type,t,true)>0){F(e);_t([se,0,320,.02-e.resource.value/1e3,,0,4,.1,,,,,,,,.2,.01,0,.01])}else{y.push({text:"Resource full",time:0})}}}}var e=g.find(e=>e.hasPlayer);if(Oe.inter==true&&Re.inter==true&&!Je&&!De&&!Ge&&ut>=1){ut=0;var e=g.find(e=>e.hasPlayer);if(e.building.type!="NONE"){kt(e)}else{if(e.resource.type!="NONE"){var t=Math.round(Ve);if(A(e.resource.type,t,true)>0){F(e);_t([se,0,320,.02-e.resource.value/1e3,,0,4,.1,,,,,,,,.2,.01,0,.01])}else{y.push({text:"Resource full",time:0})}}}}else if(Oe.inter==true&&Re.inter==true&&!Je&&!De&&!Ge){ut+=Et/100*ot}if(Oe.build==true&&Re.build==false&&!Je&&!De&&!_e&&!Ge&&!He&&!Be){if(ke.length>0){Ue=0;Je=true;Pe=B(g.find(e=>e.hasPlayer)).filter(e=>e.isVisible&&e.building.type=="NONE").sort((e,t)=>e.y-t.y).sort((e,t)=>e.x-t.x);Pe.forEach(e=>e.highlighted=true)}else{y.push({text:"No Buildings",time:0})}}else if(Oe.build==true&&Re.build==false&&Je){Fe=0;Je=false;Pe=[]}if(Oe.remove==true&&Re.remove==false&&!Je&&!De&&!_e&&!He&&!Be&&!Ge){De=true;Pe=B(g.find(e=>e.hasPlayer)).filter(e=>e.isVisible&&e.building.type!="NONE").sort((e,t)=>e.y-t.y).sort((e,t)=>e.x-t.x);Pe.forEach(e=>e.highlighted=true)}else if(Oe.remove==true&&Re.remove==false&&De){Fe=0;De=false;Pe=[]}if(Je&&Oe.inter==true&&Re.inter==false&&Pe.some(e=>e.building.type=="NONE")){I(Pe[Fe],ke[Ue]);ke=ke.filter(e=>e.value>0);Pe[Fe].highlighted=false;Pe=Pe.filter(e=>e!=Pe[Fe]);Fe=Math.min(Pe.length-1,Fe);Ue=Math.min(ke.length-1,Ue)}if(De&&Oe.inter==true&&Re.inter==false&&Pe.some(e=>e.building.type!="NONE")){N(Pe[Fe]);Pe[Fe].highlighted=false;Pe=Pe.filter(e=>e!=Pe[Fe]);Fe=Math.min(Pe.length-1,Fe)}if(Oe.esc==true&&Re.esc==false&&(Je||De||He||Be||_e)){Je=false;De=false;He=false;Be=false;_e=false;Pe=[];Fe=0;Ue=0;He=0}else if(Oe.esc==true&&Re.esc==false){Ge=true}}function Nt(){if(Oe.up==false&&Re.up==true){ne=Math.max(0,ne-1);_t([])}if(Oe.down==false&&Re.down==true){ne=Math.min(ae.length-1,ne+1);_t([])}if(Oe.esc==true&&Re.esc==false){Ge=false}if(Oe.inter==false&&Re.inter==true){switch(ae[ne]){case"Resume":Ge=false;break;case"Main Menu":le=true;Ge=false;Tt=false;ne=0;break;case"Save Game":At();y.push({text:"Game Saved",time:0});Ge=false;break;case"Load Game":Ct();Ge=false;break;case"Mute Music":gt.disconnect();ae[ne]="Unmute Music";break;case"Mute Sound FX":se=0;ae[ne]="Unmute Sound FX";break;case"Unmute Music":gt.connect(zzfxX.destination);ae[ne]="Mute Music";break;case"Unmute Sound FX":se=1;ae[ne]="Mute Sound FX";break}fe()}}function At(){var e=window.localStorage;e.setItem("Planet404_TYUDHSJ_TILES",JSON.stringify(g));e.setItem("Planet404_TYUDHSJ_TIME",JSON.stringify(nt));e.setItem("Planet404_TYUDHSJ_SOLS",JSON.stringify(rt));e.setItem("Planet404_TYUDHSJ_RESOURCES",JSON.stringify(Ce));e.setItem("Planet404_TYUDHSJ_BUILDINGS",JSON.stringify(ke));e.setItem("Planet404_TYUDHSJ_BALANCE",JSON.stringify(be));e.setItem("Planet404_TYUDHSJ_PLAYERENERGY",JSON.stringify(xe));e.setItem("Planet404_TYUDHSJ_RECIPES",JSON.stringify(ge));e.setItem("Planet404_TYUDHSJ_SHOP",JSON.stringify(de));e.setItem("Planet404_TYUDHSJ_playerMaxEnergy",JSON.stringify(Le));e.setItem("Planet404_TYUDHSJ_playerDrainRate",JSON.stringify(ze));e.setItem("Planet404_TYUDHSJ_maxStepHeight",JSON.stringify(Xe));e.setItem("Planet404_TYUDHSJ_mineFactor",JSON.stringify(Ve));e.setItem("Planet404_TYUDHSJ_maxStorage",JSON.stringify(Ke));e.setItem("Planet404_TYUDHSJ_radarRange",JSON.stringify(at));e.setItem("Planet404_TYUDHSJ_solarOutput",JSON.stringify(We));e.setItem("Planet404_TYUDHSJ_craftSpeed",JSON.stringify(qe));e.setItem("Planet404_TYUDHSJ_minerFactor",JSON.stringify(Qe));e.setItem("Planet404_TYUDHSJ_mineSpeed",JSON.stringify(je));e.setItem("Planet404_TYUDHSJ_minerTransmit",JSON.stringify(Ze));e.setItem("Planet404_TYUDHSJ_constructorTransmit",JSON.stringify($e));e.setItem("Planet404_TYUDHSJ_batteryDischarge",JSON.stringify(et));e.setItem("Planet404_TYUDHSJ_RTGOutput",JSON.stringify(tt));e.setItem("Planet404_TYUDHSJ_ENDLESS",JSON.stringify(Ye))}function Ct(){Je=false;De=false;He=false;Be=false;_e=false;Pe=[];Fe=0;Ue=0;He=0;var e=window.localStorage;g=JSON.parse(e.getItem("Planet404_TYUDHSJ_TILES"));nt=JSON.parse(e.getItem("Planet404_TYUDHSJ_TIME"));rt=JSON.parse(e.getItem("Planet404_TYUDHSJ_SOLS"));Ce=JSON.parse(e.getItem("Planet404_TYUDHSJ_RESOURCES"));ke=JSON.parse(e.getItem("Planet404_TYUDHSJ_BUILDINGS"));be=JSON.parse(e.getItem("Planet404_TYUDHSJ_BALANCE"));xe=JSON.parse(e.getItem("Planet404_TYUDHSJ_PLAYERENERGY"));ge=JSON.parse(e.getItem("Planet404_TYUDHSJ_RECIPES"));de=JSON.parse(e.getItem("Planet404_TYUDHSJ_SHOP"));Le=JSON.parse(e.getItem("Planet404_TYUDHSJ_playerMaxEnergy"));ze=JSON.parse(e.getItem("Planet404_TYUDHSJ_playerDrainRate"));Xe=JSON.parse(e.getItem("Planet404_TYUDHSJ_maxStepHeight"));Ve=JSON.parse(e.getItem("Planet404_TYUDHSJ_mineFactor"));Ke=JSON.parse(e.getItem("Planet404_TYUDHSJ_maxStorage"));at=JSON.parse(e.getItem("Planet404_TYUDHSJ_radarRange"));We=JSON.parse(e.getItem("Planet404_TYUDHSJ_solarOutput"));qe=JSON.parse(e.getItem("Planet404_TYUDHSJ_craftSpeed"));Qe=JSON.parse(e.getItem("Planet404_TYUDHSJ_minerFactor"));je=JSON.parse(e.getItem("Planet404_TYUDHSJ_mineSpeed"));Ze=JSON.parse(e.getItem("Planet404_TYUDHSJ_minerTransmit"));$e=JSON.parse(e.getItem("Planet404_TYUDHSJ_constructorTransmit"));et=JSON.parse(e.getItem("Planet404_TYUDHSJ_batteryDischarge"));tt=JSON.parse(e.getItem("Planet404_TYUDHSJ_RTGOutput"));Ye=JSON.parse(e.getItem("Planet404_TYUDHSJ_ENDLESS"));w(g,0,0)}function kt(e){switch(e.building.type){case"CONSTRUCTOR":if(_e){var t=Object.assign({},ge[Ue]);if(t.product!="EXIT"){if(e.building.energy>=t.energy){var i=t.items;if(i.filter(e=>Ce.some(t=>t.type==e.type&&t.value>=e.value)).length==i.length){e.building.recipe=t;Ce.forEach(e=>{var t=i.find(t=>t.type==e.type);if(t!=null){e.value-=t.value;y.push({text:"Used "+t.value+" units of "+e.type,time:0})}});e.building.crafting=true;e.building.energy-=t.energy;fe()}else{i.forEach(e=>{var t=Ce.find(t=>t.type==e.type&&t.value<e.value);if(t!=null){y.push({text:e.value-t.value+" more "+e.type+" needed",time:0})}else if(!Ce.some(t=>t.type==e.type)){y.push({text:e.value+" more "+e.type+" needed",time:0})}});ue()}}else{y.push({text:"Not enough energy",time:0})}}_e=false}else if(e.building.storedProduct){C(e.building.recipe.product,1);y.push({text:"Gained "+e.building.recipe.product,time:0});e.building.storedProduct=false;e.building.recipe=null;e.building.craftTimer=0;fe()}else if(e.building.recipe==null){_e=true;Ue=0}break;case"MINER":if(!Ze){if(e.building.storedResource==0){y.push({text:"Resource full",time:0})}else{var a=A(e.building.storedType,e.building.storedResource,false);if(a==0){ue();y.push({text:"Resource full"+a+e.building.storedType,time:0})}else{e.building.storedResource-=A(e.building.storedType,e.building.storedResource,false);y.push({text:"Gained "+a+e.building.storedType,time:0});fe()}}}break;case"TELEDEPOT":if(He){var n=he.filter(e=>Ce.some(t=>e.type==t.type&&t.value>=e.ammount)||e.type=="EXIT")[Ie];if(n.type!="EXIT"){var r=Ce.find(e=>e.type==n.type);if(r.value>=n.ammount){r.value-=n.ammount;be+=n.ammount*n.price;_t([se,.01,287,.11,,0,3,.01,,,198,.09,,,,,.06,.5])}else{y.push({text:"Cannot sell "+n.ammount+" of "+n.type,time:0})}}else{Ie=0;He=false}}else{Ie=0;He=true}break;case"ROBOSHOP":if(Be){if(de[Ae].type!="EXIT"){if(be>=de[Ae].cost){be-=de[Ae].cost;switch(de[Ae].item){case"RESOURCE STORAGE":Ke=Math.round(Ke*1.2);break;case"BATTERY EFFICENCY":Le=Math.round(Le*1.25);break;case"CRAFT HEIGHT TOLERANCE":Xe+=1;break;case"CONSTRUCTOR SPEED":qe=qe*1.3;break;case"CONSTRUCTOR TRANSMITTER":$e=true;de=de.filter(e=>e.item!="CONSTRUCTOR TRANSMITTER");break;case"MINER SPEED":je=je*1.5;break;case"MINER TRANSMITTER":Ze=true;de=de.filter(e=>e.item!="MINER TRANSMITTER");break;case"RTG OUTPUT":tt+=1;break;case"SOALR OUTPUT":We+=1;break;case"GENERATOR OUTPUT":it+=1;break;case"RADAR RADIUS":at+=3;E();break;case"CONSTRUCTOR":ge.push({product:"CONSTRUCTOR",items:[{type:"IRON",value:10},{type:"COPPER",value:15}],energy:4});de=de.filter(e=>e.item!="CONSTRUCTOR");break;case"MINER":ge.push({product:"MINER",items:[{type:"IRON",value:10},{type:"COPPER",value:15},{type:"CARBON",value:8}],energy:4});de=de.filter(e=>e.item!="MINER");break;case"GENERATOR":ge.push({product:"GENERATOR",items:[{type:"IRON",value:20},{type:"COPPER",value:25},{type:"ROCK",value:15}],energy:5});de=de.filter(e=>e.item!="GENERATOR");break;case"BATTERY":ge.push({product:"BATTERY",items:[{type:"IRON",value:10},{type:"COPPER",value:10},{type:"LITHIUM",value:5}],energy:8});de=de.filter(e=>e.item!="BATTERY");break;case"SOLAR":ge.push({product:"SOLAR",items:[{type:"COPPER",value:5},{type:"SILICON",value:10}],energy:10});de=de.filter(e=>e.item!="SOLAR");break;case"RTG":ge.push({product:"RTG",items:[{type:"IRON",value:25},{type:"COPPER",value:25},{type:"PLUTONIUM",value:10}],energy:10});de=de.filter(e=>e.item!="RTG");break}if(de[Ae].costMulti!=null){de[Ae].cost=Math.round(de[Ae].cost*de[Ae].costMulti)}fe()}else{y.push({text:"Cannot afford "+de[Ae].item,time:0});ue()}}else{Be=false}}else{Be=true}break;case"GENERATOR":var l=Ce.find(e=>e.type=="CARBON");if(l!=null){if(e.building.coal<e.building.maxCoal){e.building.coal+=1;l.value-=1;fe()}else{y.push({text:"Generator is full",time:0})}}else{y.push({text:"No available carbon",time:0});ue()}break}}function Ut(){var e=c.height*.12;var t=40;var i=55;var a=25;if(st){if(lt>=1){_t([se,0,500,.2,,0,1,.5,,,50,.12,,,,,,,.01]);ft=!ft;lt=0}}else{ft=false}if(ft){d.strokeStyle="#FF0000"}else{d.strokeStyle=ct.outline}var n=i+a*Ce.length+c.height*.05;d.fillStyle=ct.infill;var r=G(n);d.beginPath();for(var l=0;l<r.length;l++){if(l==0){d.moveTo(r[l].x,r[l].y)}else{d.lineTo(r[l].x,r[l].y)}}d.closePath();d.fill();d.stroke();d.font="15px Arial";d.fillStyle="#FFFFFF";d.strokeStyle="#000000";d.textAlign="start";d.textBaseline="alphabetic";while(y.length>3){y.shift()}y=y.filter(e=>e.time<2e3);var s=y.length*25;y.forEach(e=>{d.fillText(e.text,c.width*.01,c.height*.42+6*25-s+y.indexOf(e)*25);e.time+=Et});d.textAlign="center";d.textBaseline="middle";d.font="25px Arial";d.fillText("Inventory",c.width*.92,30);d.font="15px Arial";Ce.forEach(e=>{if(He){if(he.filter(t=>he.filter(e=>Ce.some(t=>e.type==t.type&&t.value>=e.ammount)||e.type=="EXIT")[Ie].type==e.type)){d.fillStyle=ct.dynamicText}else{d.fillStyle=ct.staticText}}else{d.fillStyle=ct.text}d.fillText(e.value+"/"+Ke+" units of "+e.type,c.width*.92,25+i+Ce.indexOf(e)*a)});d.fillStyle=ct.text;d.fillText("Sol: "+(rt+1)+" Planet Rotation: "+nt.toFixed(0)+"°",c.width/2,15);if(!Je&&!De&&!_e&&!He&&!Be&&(nt<=8||nt>=352)){if(nt<3||nt>=357){d.strokeStyle=ct.outline;d.fillStyle=ct.infill;H(.05,.14,.39);d.font="30px Tahoma";d.fillStyle="#FFFFFF";d.fillText("Sol "+(rt+1)+"/7",c.width/2,e)}else if(nt<=8){var f=D(255-255*((nt-3)/5));d.strokeStyle=ct.outline+f;d.fillStyle=ct.infill;H(.05,.14,.39);d.font="30px Tahoma";d.fillStyle="#FFFFFF"+f;d.fillText("Sol "+(rt+1)+"/7",c.width/2,e)}else if(nt>=352){var f=D(255*((nt-352)/5));d.strokeStyle=ct.outline+f;d.fillStyle=ct.infill;H(.05,.14,.39);d.font="30px Tahoma";d.fillStyle="#FFFFFF"+f;d.fillText("Sol "+(rt+1)+"/7",c.width/2,e)}}if(Je){d.strokeStyle=ct.outline;d.fillStyle=ct.infill;H(.05,.5,.4);d.font="30px Tahoma";d.fillStyle="#FFFFFF";d.fillText("Build Mode",c.width/2,e);d.font="20px Tahoma";var u=5;var o=ke.filter(e=>Math.abs(ke.indexOf(e)-Ue)<u+Math.max(0,u-1-Ue));o.forEach(i=>{var a=ke.indexOf(i);if(Ue==a){d.fillStyle=ct.dynamicText}else{d.fillStyle=ct.staticText}if(i.type!="EXIT"){d.fillText(i.value+" "+i.type,c.width/2,e+t+25*o.indexOf(i))}else{d.fillText(i.type,c.width/2,e+t+25*o.indexOf(i))}})}if(De){d.strokeStyle=ct.outline;d.fillStyle=ct.infill;H(.05,.14,.39);d.fillStyle="#FFFFFF";d.font="30px Tahoma";d.fillText("Remove Mode",c.width/2,e)}if(_e){d.strokeStyle=ct.outline;d.fillStyle=ct.infill;H(.05,.5,.3);d.beginPath();d.moveTo(c.width*.5,c.height*.07);d.lineTo(c.width*.5,c.height*.53);d.stroke();d.fillStyle="#FFFFFF";d.font="30px Tahoma";d.fillText("Set Recipe:",c.width*.4,e+c.width*.01);d.font="20px Tahoma";var u=5;var o=ge.filter(e=>Math.abs(ge.indexOf(e)-Ue)<u+Math.max(0,u-1-Ue));o.forEach(i=>{var a=ge.indexOf(i);if(Ue==a){d.fillStyle=ct.dynamicText}else{d.fillStyle=ct.staticText}if(i.product=="EXIT"){d.fillText(i.product,c.width*.4,e+c.width*.01+t+25*o.indexOf(i))}else{if(Ue==a){d.font="25px Tahoma";i.items.forEach(a=>d.fillText(a.value+" "+a.type,c.width*.59,e+c.width*.01+t+25*i.items.indexOf(a)));d.fillText(i.energy+" ENERGY",c.width*.59,e+c.width*.01+t+25*i.items.length)}d.font="20px Tahoma";d.fillText(i.product,c.width*.4,e+c.width*.01+t+25*o.indexOf(i))}})}if(He){d.strokeStyle=ct.outline;d.fillStyle=ct.infill;H(.05,.5,.4);d.font="30px Tahoma";d.fillStyle="#FFFFFF";d.fillText("Sell Mode",c.width/2,e);d.font="20px Tahoma";var u=5;var h=he.filter(e=>Ce.some(t=>e.type==t.type&&t.value>=e.ammount)||e.type=="EXIT");var o=h.filter(e=>Math.abs(h.indexOf(e)-Ie)<u+Math.max(0,u-1-Ie));o.forEach(i=>{var a=h.indexOf(i);if(Ie==a){d.fillStyle=ct.dynamicText}else{d.fillStyle=ct.staticText}if(i.type!="EXIT"){d.fillText(i.ammount+" "+i.type+" : ₿"+i.price*i.ammount,c.width/2,e+t+25*o.indexOf(i))}else{d.fillText(i.type,c.width/2,e+t+25*o.indexOf(i))}})}if(Be){d.strokeStyle=ct.outline;d.fillStyle=ct.infill;H(.05,.5,.2);d.beginPath();d.moveTo(c.width*.5,c.height*.07);d.lineTo(c.width*.5,c.height*.53);d.stroke();if(de[Ae].type!="EXIT"){d.beginPath();d.moveTo(c.width*.5,c.height*.46);d.lineTo(c.width*.78,c.height*.46);d.stroke()}d.font="30px Tahoma";d.fillStyle="#FFFFFF";d.fillText("Buy Mode",c.width*.36,e);d.font="20px Tahoma";var u=5;var o=de.filter(e=>Math.abs(de.indexOf(e)-Ae)<u+Math.max(0,u-1-Ae));o.forEach(i=>{var a=de.indexOf(i);if(Ae==a){d.fillStyle=ct.dynamicText}else{d.fillStyle=ct.staticText}d.textAlign="center";d.textBaseline="middle";if(i.type!="EXIT"){d.font="20px Tahoma";d.fillText(i.item,c.width*.36,e+20+t+25*o.indexOf(i));if(Ae==a){d.fillText(i.type,c.width*.65,e+20);d.fillText("₿"+Ne.toLocaleString("en-US",{maximumFractionDigits:0}),c.width*.64,c.height*.495);d.font="20px Tahoma";d.textAlign="start";i.desc.forEach(a=>d.fillText(a,c.width*.51,e+20+t+25*i.desc.indexOf(a)))}}else{d.font="20px Tahoma";d.fillText(i.type,c.width*.36,e+20+t+25*o.indexOf(i))}});Ne=P(de[Ae].cost,Ne,Et/80)}d.textAlign="center";d.textBaseline="middle";d.fillStyle="#FFFFFF";d.font="20px Tahoma";d.fillText("JMC",c.width*.05,c.height*.14);R(c.width*.05,c.height*.07,50);if(!Ye){d.fillText("Daily Quota:",c.width*.05,c.height*.22)}else{d.fillText("Endless",c.width*.05,c.height*.22);d.fillText("Mode",c.width*.05,25+c.height*.22)}d.font="25px Tahoma";d.fillText("₿"+ve.toLocaleString("en-US",{maximumFractionDigits:0}),c.width*.05,c.height*.18);ve=P(be,ve,Et/100);if(!Ye){if(be>=Me[rt]){d.fillStyle="#00FF00"}else if(nt>300&&Math.trunc(nt)%2==0){d.fillStyle="#FF0000"}d.fillText("₿"+Me[rt].toLocaleString("en-US",{maximumFractionDigits:0}),c.width*.05,c.height*.26)}d.fillStyle="#FFFFFF";d.font="15px Tahoma";var m=.45;O(c.width*.02,c.height*m,100,xe/Le);if(ft){d.fillStyle="#FF0000"}d.fillText("Battery",c.width*.07,c.height*(m-.13));d.fillText("Status:",c.width*.07,c.height*(m-.11));var x=xe/Le;d.font="12px Tahoma";d.fillText(ht,c.width*.07,c.height*(m-.09));d.fillStyle="#FFFFFF";if(g.find(e=>e.hasPlayer).hazard>0){d.font="50px Tahoma";d.fillText("☢",c.width*.07,c.height*(m-.032))}if(x>.6){ht="Nominal";st=false}else if(x>.4){ht="Satisfactory";st=false}else if(x>.3){ht="Low";st=false;lt=0}else if(xe<=15&&xe>10){ht="Very Low";st=true;lt+=Et/400}else if(xe<=10&&xe>5){ht="Critical";st=true;lt+=Et/150}else if(xe<=5){ht="Deadly";st=true;lt+=Et/50}}function Jt(e){var t=c.width*.85;var i=c.height*.45;var a=20;d.lineWidth=2;d.textAlign="start";d.textBaseline="alphabetic";switch(e.building.type){case"SOLAR":var n=We*Math.max(.25,Math.sin(nt*Math.PI/180));if(e.hasPlayer&&xe<Le){xe=Math.min(Le,xe+n*(Et/1e3))}else{var r=B(e).filter(e=>e.building.energy!=null).filter(e=>e.building.energy!=e.building.maxEnergy);var l=n/r.length*(Et/1e3);r.forEach(e=>{if(e.building.energy+l>=e.building.maxEnergy){e.building.energy=e.building.maxEnergy}else{e.building.energy+=l}})}if(e.hasPlayer&&!Ge){d.textAlign="center";d.fillText("⚡",t+9,i+a);O(t,i+a*2+c.height*.08,c.height*.1,Math.min(1,n/We))}break;case"CONSTRUCTOR":if(e.building.recipe!=null){if(e.building.crafting){e.building.craftTimer+=Et/1e4*qe;if(e.building.craftTimer>=1){if($e){C(e.building.recipe.product,1);e.building.recipe=null;playerTile.building.craftTimer=0}else{e.building.storedProduct=true}e.building.crafting=false}}}if(e.hasPlayer&&!Ge){d.fillText("Recipe: "+(e.building.recipe!=undefined?e.building.recipe.product:"None"),t,i);d.textAlign="center";d.fillText("⚡",t+9,i+a);if(e.building.storedProduct){d.fillStyle="#00FF00"}d.fillText("%",19+t+c.height*.1*.25,i+a);O(t,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.energy/e.building.maxEnergy));O(10+t+c.height*.1*.25,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.craftTimer))}break;case"MINER":if(!e.building.mining){if(e.building.energy>=1&&e.resource.type!="NONE"&&e.building.storedResource<e.building.maxStored){e.building.energy-=1;e.building.mining=true}}else{e.building.mineTimer+=Et/25e3*je;if(e.building.mineTimer>=1){e.building.storedResource=Math.min(e.building.maxStored,e.building.storedResource+Qe);F(e);e.building.mining=false;e.building.mineTimer=0}}if(Ze){e.building.storedResource-=A(e.building.storedType,e.building.storedResource,false)}if(e.hasPlayer&&!Ge){d.textAlign="center";d.fillText("⚡",t+9,i+a);d.fillText("%",19+t+c.height*.1*.25,i+a);d.fillText("⨆",29+t+c.height*.1*.5,i+a);O(t,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.energy/e.building.maxEnergy));O(10+t+c.height*.1*.25,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.mineTimer));O(20+t+c.height*.1*.5,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.storedResource/e.building.maxStored))}break;case"BATTERY":var r=B(e).filter(e=>e.building.energy!=null).filter(e=>e.building.energy!=e.building.maxEnergy);var s=r.filter(e=>e.building.type=="BATTERY").filter(t=>t.building.energy+1<e.building.energy);var f=r.filter(e=>e.building.type!="BATTERY");if(e.building.discharging){e.building.dischargeTimer+=Et/1e4*et;if(r.length==0){e.building.dischargeTimer=0;e.building.discharging=false;e.building.energy=Math.min(e.building.energy+1,e.building.maxEnergy)}if(e.building.dischargeTimer>=1){e.building.dischargeTimer=0;e.building.discharging=false;if(f.length>0){f.forEach(e=>e.building.energy+=1/f.length)}else if(s.length>0){s.forEach(e=>e.building.energy+=1/s.length)}}}else{if(e.building.energy>=1&&(f.length>0||s.length>0)){e.building.energy-=1;e.building.discharging=true}}if(e.hasPlayer&&!Ge){d.textAlign="center";d.fillText("⚡",t+9,i+a);d.fillText("%",19+t+c.height*.1*.25,i+a);O(t,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.energy/e.building.maxEnergy));O(10+t+c.height*.1*.25,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.dischargeTimer))}break;case"RTG":if(e.hasPlayer&&xe<Le){xe=Math.min(Le,xe+tt*(Et/1e3))}else{var r=B(e).filter(e=>e.building.energy!=null).filter(e=>e.building.energy!=e.building.maxEnergy);var l=tt/r.length*(Et/1e3);r.forEach(e=>{if(e.building.energy+l>=e.building.maxEnergy){e.building.energy=e.building.maxEnergy}else{e.building.energy+=l}})}break;case"GENERATOR":if(e.building.generatingTimer>=1){if(e.hasPlayer&&xe<Le){xe=Math.min(Le,xe+it)}else{var r=B(e).filter(e=>e.building.energy!=null).filter(e=>e.building.energy!=e.building.maxEnergy);var l=it/r.length;r.forEach(e=>{if(e.building.energy+l>=e.building.maxEnergy){e.building.energy=e.building.maxEnergy}else{e.building.energy+=l}})}e.building.generatingTimer=0;e.building.generating=false}else if(e.building.generatingTimer<1&&e.building.generating){e.building.generatingTimer+=Et/800}else if(e.building.coal>=1&&(e.hasPlayer&&xe<Le||B(e).filter(e=>e.building.energy!=null).filter(e=>e.building.energy!=e.building.maxEnergy).length>0)){e.building.coal-=1;e.building.generatingTimer=0;e.building.generating=true}if(e.hasPlayer){d.textAlign="center";d.fillText("⨆",t+9,i+a);d.fillText("%",19+t+c.height*.1*.25,i+a);O(t,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.coal/e.building.maxCoal));O(10+t+c.height*.1*.25,i+a*2+c.height*.08,c.height*.1,Math.min(1,e.building.generatingTimer))}break}}function Dt(){ze=0;Le=1e10;xe=1e10;g.forEach(e=>e.isVisible=true);me=5}document.addEventListener("keydown",e=>{switch(e.keyCode){case 87:Oe.up=true;break;case 83:Oe.down=true;break;case 68:Oe.right=true;break;case 65:Oe.left=true;break;case 69:Oe.inter=true;break;case 32:Oe.inter=true;break;case 66:Oe.build=true;break;case 82:Oe.remove=true;break;case 27:Oe.esc=true;break;case 16:Oe.speve=true;break}});document.addEventListener("keyup",e=>{switch(e.keyCode){case 87:Oe.up=false;break;case 83:Oe.down=false;break;case 68:Oe.right=false;break;case 65:Oe.left=false;break;case 69:Oe.inter=false;break;case 32:Oe.inter=false;break;case 66:Oe.build=false;break;case 82:Oe.remove=false;break;case 27:Oe.esc=false;break;case 16:Oe.speve=false;break}});let _t=e=>zzfx(...e).start();setInterval(Rt,50);